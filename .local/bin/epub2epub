#!/usr/bin/env bash

EPUB_FILE=$1
EPUB_FILE_NAME=$(basename "${EPUB_FILE%.*}" | tr -d '\n')
DEFAULT_EPUB_OUT_FILE="$(pwd)/out/$EPUB_FILE_NAME.epub"
EPUB_OUT_FILE=${2:-$DEFAULT_EPUB_OUT_FILE}

pushd "$EPUB_FILE" || exit 1;
find . -name "iTunesMetadata*" -exec rm -rf {} \;
mkdir -p "$(dirname "$EPUB_OUT_FILE")";
zip -X -r "$EPUB_OUT_FILE" mimetype *;
popd || exit 1;
