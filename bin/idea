#!/bin/sh

# check for where the latest version of IDEA is installed
IDEA=`find $HOME/Library/Application\ Support/JetBrains/Toolbox/apps/IDEA-U -d -type d -name "IntelliJ*.app" | head -n1`
wd=`pwd`

# were we given a directory?
if [ -d "$1" ]; then
    #  echo "checking for things in the working dir given"
    wd=`ls -1d "$1" | head -n1`
fi

if [ -f "$1" ]; then
    open -a "$IDEA" "$1"
else
    # let's check for stuff in our working directory.
    pushd $wd > /dev/null

    # does our working dir have an .idea directory?
    if [ -d ".idea" ]; then
        open -a "$IDEA" .
    elif [ -f *.ipr ]; then
        open -a "$IDEA" `ls -1d *.ipr | head -n1`
    elif [ -f pom.xml ]; then
        open -a "$IDEA" "pom.xml"
    else
        open "$IDEA"
    fi

    popd > /dev/null
fi
